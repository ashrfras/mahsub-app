ئورد مكون، عنصرمخصص، عنصرئشتمل، عنصرئدخال؛
ئورد مكون.طافية.طافية؛
ئورد الكل من تنسيق؛
ئورد المستند من مستند؛
ئورد مشهد.عنصر.عنصرمخزون؛
ئورد مختطمنتج من صنفمجال.منتج؛
ئورد الكل ك مجالمنتج من صنفمجال.منتج؛
ئورد مكون.غمازة؛
ئورد صحيحمننصية من عدد؛
ئورد الكل ك مجالتصنيف من صنفمجال.تصنيف؛
ئورد مختطتصنيف من صنفمجال.تصنيف؛
ئورد عنصرتحديد؛
ئعلن طفمنتج ()؛
ئعلن طفمنتج.عندحفض () ك وعد؛
ئعلن طفمنتج.حددت () ك وعد؛
ئعلن طفمنتج.صيير ()؛
ئعلن طفمنتج.ئغلقطافية ()؛
ئعلن مدخل ()؛
ئعلن طفمنتج ():
	يمدد مكون()؛
	يملك مركب {
		نصية معرفمنتج،
		عنصرمخزون عنصرمنت،
		مكون مكونتحديت
	} حالة = {
		معرفمنتج: عدم،
		عنصرمنت: عدم،
		مكونتحديت: عدم
	}؛
	يملك مختطمنتج منتج؛
	يملك مختطتصنيف[] تصنيفات = []؛
تم

ئعلن طفمنتج.عندحفض () ك وعد:
	عنصرئدخال[] ئدخات = مصفوفة.ئنشئمن(هدا.ئستعلمكل((<ئدخال>)) ك مصفوفة)؛
	عنصرتحديد تحديد = هدا.ئستعلم((<تحديد>))؛
	لكل ئدخ في ئدخات:
		ئدا ئدخ.لهخاصية('ئجباري') وو (ئدخ.قيمة == ''):
			غمازة غمز = المستند.ئستعلم((<غمازة>))؛
			غمز.خدحالة({
				رسالة: 'يرجى ملئ جميع الحقول الإجبارية'
			})؛
			ئرجع؛
		تم
	تم
	مختطمنتج منت = هدا.منتج؛
	ئدا منت:
		#نحن نعددل منتج موجود؛
		منت.ئسمنتج = ئدخات[0].قيمة؛
		منت.وصفمنتج = ئدخات[1].قيمة ئو ''؛
		منت.سعرشرائ = صحيحمننصية(ئدخات[2].قيمة)؛
		منت.سعر = صحيحمننصية(ئدخات[3].قيمة)؛
		منت.معرفتصنيف = تحديد.قيمة؛
	وئلا:
		#نحن نضيف منتج جديدا؛
		منت = {
			ئسمنتج: ئدخات[0].قيمة،
			وصفنتج: ئدخات[1].قيمة ئو ''،
			سعرشرائ: صحيحمننصية(ئدخات[2].قيمة)،
			سعر: صحيحمننصية(ئدخات[3].قيمة)،
			معرفتصنيف: تحديد.قيمة
		}؛
	تم
	ريتما مجالمنتج.ئحفض(منت)؛
	
	ئدا هدا.حالة.عنصرمنت:
		هدا.حالة.عنصرمنت.خدحالة({
			ئسمنتج: منت.ئسمنتج،
			سعر: منت.سعر
		})؛
	تم
	
	ئدا هدا.حالة.مكونتحديت:
		هدا.حالة.مكونتحديت.حممل()؛
	تم
	
	هدا.ئغلقطافية()؛
تم

ئعلن طفمنتج.حددت () ك وعد:
	هدا.تصنيفات = ريتما مجالتصنيف.ردجميع()؛
	ئدا هدا.حالة.معرفمنتج:
		هدا.منتج = ريتما مجالمنتج.ردبمعرف(هدا.حالة.معرفمنتج)؛
	وئلا:
		هدا.منتج = عدم؛
	تم
	هدا.حددتمشهد()؛
	هدا.ئربطحدتين()؛
	ئدا هدا.منتج:
		قل 'هنا'؛
		قل هدا.منتج.معرفتصنيف؛
		عنصرئدخال تحديد = هدا.ئستعلم((<تحديد>))؛
		تحديد.قيمة = هدا.منتج.معرفتصنيف؛
	تم
تم

ئعلن طفمنتج.صيير ():
	مختطتصنيف تصن؛
	ئرجع (
		<قسم صنف="مخطط-طولي خلف-ئبيض">
			<صورة مصدر="ملفا/منتج.jpeg" صنف="فمقوسكب ط-48" سمة="object-fit:cover"></صورة>
			<قسم صنف="مخطط-طولي فجوة-2 هش-2">
				<قسم صنف="مخطط-عرضي ئصفف-وسط">
					<قسم صنف="ع-ئربعون">الاسم:</قسم>
					<ئدخال ئجباري صنف="%{تنسيق.ئدخال} يملئ ط-8" ستنب="اسم المنتج" قيمة="%{هدا.منتج.ئسمنتج ئدا هدا.منتج وئلا ''}"></ئدخال>
				</قسم>
				<قسم صنف="مخطط-عرضي ئصفف-وسط">
					<قسم صنف="ع-ئربعون">الوصف \(اختياري\):</قسم>
					<ئدخال صنف="%{تنسيق.ئدخال} يملئ ط-8" ستنب="يساعد في العثور على المنتج" قيمة="%{هدا.منتج.وصفمنتج ئدا هدا.منتج وئلا ''}"></ئدخال>
				</قسم>
				<قسم صنف="مخطط-عرضي ئصفف-وسط">
					<قسم صنف="ع-ئربعون">سعر الشراء:</قسم>
					<ئدخال ئجباري صنف="%{تنسيق.ئدخال} يملئ ط-8" ستنب="سعر شراء المنتج" قيمة="%{هدا.منتج.سعرشرائ ئدا هدا.منتج وئلا ''}"></ئدخال>
				</قسم>
				<قسم صنف="مخطط-عرضي ئصفف-وسط">
					<قسم صنف="ع-ئربعون">سعر البيع:</قسم>
					<ئدخال ئجباري صنف="%{تنسيق.ئدخال} يملئ ط-8" ستنب="سعر بيع المنتج" قيمة="%{هدا.منتج.سعر ئدا هدا.منتج وئلا ''}"></ئدخال>
				</قسم>
				<قسم صنف="مخطط-عرضي ئصفف-وسط">
					<قسم صنف="ع-ئربعون">التصنيف:</قسم>
					<تحديد صنف="%{تنسيق.ئدخال} يملئ ط-8">
						<تكرار لكل="تصن" في="هدا.تصنيفات">
							<خيار قيمة="%{تصن._معرف}">%{تصن.ئسمتصنيف}</خيار>
						</تكرار>
					</تحديد>
				</قسم>
			</قسم>
			<قسم صنف="مخطط-عرضي فجوة-2 هش-2">
				<زرئدخ عندنقر="ئغلقطافية" ملصق="إلغاء" صنف="يملئ يكبر" تانوي></زرئدخ>
				<زرئدخ عندنقر="عندحفض" ملصق="حفظ" صنف="يملئ يكبر"></زرئدخ>
			</قسم>
		</قسم>
	)؛
تم

ئعلن طفمنتج.ئغلقطافية ():
	طافية طف = المستند.ئستعلم('#طفتعديلمنتج')؛
	طف.ئخفي()؛
تم

ئعلن مدخل ():
	عنصرمخصص.سججل('طفمنتج'، طفمنتج)؛
تم