ئورد مكون، عنصرمخصص، عنصرئشتمل، عنصرئدخال؛
ئورد مكون.طافية.طافية؛
ئورد الكل من تنسيق؛
ئورد المستند من مستند؛
ئورد مشهد.عنصر.عنصرمخزون؛
ئورد مختطمنتج من صنفمجال.منتج؛
ئورد الكل ك مجالمنتج من صنفمجال.منتج؛
ئورد مكون.غمازة؛
ئورد صحيحمننصية من عدد؛
ئورد الكل ك مجالتصنيف من صنفمجال.تصنيف؛
ئورد مختطتصنيف من صنفمجال.تصنيف؛
ئورد عنصرتحديد؛
ئورد URL من '//'؛
ئورد ئساسية.نف.ملف؛
ئورد مكون.حقلئدخ؛
ئورد ردئسمخام من ئساسية.نوعميم؛
ئورد بتشمرفق من مكون.بتشدبي؛
ئعلن طفمنتج ()؛
ئعلن طفمنتج.ئغلقطافية ()؛
ئعلن طفمنتج.حددت () ك وعد؛
ئعلن طفمنتج.صيير ()؛
ئعلن طفمنتج.عندحفض () ك وعد؛
ئعلن مدخل ()؛
ئعلن طفمنتج ():
	يمدد مكون()؛
	يملك مركب {
		نصية معرفمنتج،
		عنصرمخزون عنصرمنت،
		مكون مكونتحديت،
		ملف ملفصورة
	} حالة = {
		معرفمنتج: عدم،
		عنصرمنت: عدم،
		مكونتحديت: عدم،
		ملفصورة: عدم
	}؛
	يملك مختطمنتج منتج؛
	يملك مختطتصنيف[] تصنيفات = []؛
تم

ئعلن طفمنتج.ئغلقطافية ():
	طافية طف = المستند.ئستعلم('#طفتعديلمنتج')؛
	طف.ئخفي()؛
تم

ئعلن طفمنتج.حددت () ك وعد:
	هدا.تصنيفات = ريتما مجالتصنيف.ردجميع()؛
	ئدا هدا.حالة.معرفمنتج:
		هدا.منتج = ريتما مجالمنتج.ردبمعرف(هدا.حالة.معرفمنتج)؛
	وئلا:
		هدا.منتج = عدم؛
	تم
	هدا.حددتمشهد()؛
	هدا.ئربطحدتين()؛
	ئدا هدا.منتج:
		عنصرئدخال تحديد = هدا.ئستعلم((<تحديد>))؛
		تحديد.قيمة = هدا.منتج.معرفتصنيف؛
	تم
	ئدا هدا.حالة.ملفصورة:
		عنصرئشتمل عنصورة = هدا.ئستعلم('#صورتمنتج')؛
		دع رابطصورة = URL.createObjectURL(هدا.حالة.ملفصورة)؛
		عنصورة['src'] = رابطصورة؛
	تم
تم

ئعلن طفمنتج.صيير ():
	مختطتصنيف تصن؛
	ئرجع (
		<قسم صنف="مخطط-طولي خلف-ئبيض">
			<صورة معرف="صورتمنتج" مصدر="ملفا/منتج.jpeg" صنف="فمقوسكب ط-48" سمة="object-fit:cover"></صورة>
			<قسم صنف="مخطط-طولي فجوة-2 هش-2">
				<قسم صنف="مخطط-عرضي ئصفف-وسط">
					<قسم صنف="ع-ئربعون ئدنع-ئربعون">الاسم:</قسم>
					<حقلئدخ ئجباري صنف="يملئ" تنسيق="ط-8:هام ع-كامل:هام" ستنب="اسم المنتج" قيمة="%{هدا.منتج.ئسمنتج ئدا هدا.منتج وئلا ''}"></حقلئدخ>
				</قسم>
				<قسم صنف="مخطط-عرضي ئصفف-وسط">
					<قسم صنف="ع-ئربعون ئدنع-ئربعون">الوصف \(اختياري\):</قسم>
					<حقلئدخ صنف="يملئ" تنسيق="ط-8:هام ع-كامل:هام" ستنب="يساعد في العثور على المنتج" قيمة="%{هدا.منتج.وصفمنتج ئدا هدا.منتج وئلا ''}"></حقلئدخ>
				</قسم>
				<قسم صنف="مخطط-عرضي ئصفف-وسط">
					<قسم صنف="ع-ئربعون ئدنع-ئربعون">سعر البيع:</قسم>
					<حقلئدخ ئجباري صنف="يملئ" تنسيق="ط-8:هام ع-كامل:هام" ستنب="سعر بيع المنتج" قيمة="%{هدا.منتج.سعر ئدا هدا.منتج وئلا ''}"></حقلئدخ>
				</قسم>
				<قسم صنف="مخطط-عرضي ئصفف-وسط">
					<قسم صنف="ع-ئربعون ئدنع-ئربعون">التصنيف:</قسم>
					<تحديد صنف="%{تنسيق.ئدخال} يملئ ط-8">
						<تكرار لكل="تصن" في="هدا.تصنيفات">
							<خيار قيمة="%{تصن._معرف}">%{تصن.ئسمتصنيف}</خيار>
						</تكرار>
					</تحديد>
				</قسم>
			</قسم>
			<قسم صنف="مخطط-عرضي فجوة-2 هش-2">
				<زرئدخ عندنقر="ئغلقطافية" ملصق="إلغاء" صنف="يملئ يكبر" تانوي></زرئدخ>
				<زرئدخ عندنقر="عندحفض" ملصق="حفظ" صنف="يملئ يكبر"></زرئدخ>
			</قسم>
		</قسم>
	)؛
تم

ئعلن طفمنتج.عندحفض () ك وعد:
	حقلئدخ[] ئدخات = مصفوفة.ئنشئمن(هدا.ئستعلمكل((<حقلئدخ>)) ك مصفوفة)؛
	عنصرتحديد تحديد = هدا.ئستعلم((<تحديد>))؛
	منطق محقق = صحيح؛
	لكل ئدخ في ئدخات:
		محقق = ئدخ.ئفحص() وو محقق؛
	تم
	ئدا محقق:
		مختطمنتج منت = هدا.منتج؛
		ئدا منت:
			#نحن نعددل منتج موجود؛
			منت.ئسمنتج = ئدخات[0].ردقيمة()؛
			منت.وصفمنتج = ئدخات[1].ردقيمة() ئو ''؛
			منت.سعر = صحيحمننصية(ئدخات[2].ردقيمة())؛
			منت.معرفتصنيف = تحديد.قيمة؛
		وئلا:
			#نحن نضيف منتج جديدا؛
			بتشمرفق مرفق = {
				ئسم: 'صورة'،
				نوع: ردئسمخام('بنجي')،
				محتوا: هدا.حالة.ملفصورة
			}؛
			منت = {
				ئسمنتج: ئدخات[0].ردقيمة()،
				وصفنتج: ئدخات[1].ردقيمة() ئو ''،
				سعر: صحيحمننصية(ئدخات[2].ردقيمة())،
				معرفتصنيف: تحديد.قيمة،
				_مرفقات: [مرفق]
			}؛
		تم
		ريتما مجالمنتج.ئحفض(منت)؛
		
		ئدا هدا.حالة.عنصرمنت:
			هدا.حالة.عنصرمنت.خدحالة({
				ئسمنتج: منت.ئسمنتج،
				سعر: منت.سعر
			})؛
		تم
		
		ئدا هدا.حالة.مكونتحديت:
			هدا.حالة.مكونتحديت.حممل()؛
		تم
		
		هدا.ئغلقطافية()؛
	تم
تم

ئعلن مدخل ():
	عنصرمخصص.سججل('طفمنتج'، طفمنتج)؛
تم